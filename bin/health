#!/bin/bash

NTP=`ntpstat | grep synchronised`

if [ "$NTP" == "" ];then
    NTPSTATUS="'ntp':'bad'"
else
    NTPSTATUS="'ntp':'good'"
fi

DISK=`df -h | grep root | awk '{ print $5 }' | cut -d'%' -f1`
if [ $DISK -gt 80 ];then
    DISKSTATUS="'diskspace':'bad'"
else
    DISKSTATUS="'diskspace':'good'"
fi

BATT=`python /home/pi/tgr/bin/pijuicestats.py`
BATT_STAT=`echo $BATT | awk -F': ' '{ print $2 }' | awk -F',' '{ print $1 }' | sed s/"'"/""/g`
BATT_CHARGE=`echo $BATT | awk -F': ' '{ print $3 }' | sed s/"}"/""/g`
BATTSTATUS="'battery':'check'"
if [ "$BATT_STAT" == "CHARGING_FROM_IN" ] || [ "$BATT_STAT" == "CHARGING_FROM_5V_IO" ];then
    if [ $BATT_CHARGE -gt 80 ];then
        BATTSTATUS="'battery':'good'"
    fi
fi

SERVICES=`/home/pi/tgr/bin/services | egrep 'disabled|inactive|dead'`
if [ "$SERVICES" == "" ];then
    SVCSTATUS="'services':'up'"
else
    SVCSTATUS="'services':'down'"
fi

CPUTEMP=`vcgencmd measure_temp | awk -F'=' '{ print $2 }' | cut -f1 -d'.'`
if [ $CPUTEMP -gt 79 ];then
    CPUSTATUS="'cpu':'overheating'"
else
    CPUSTATUS="'cpu':'good'"
fi

echo "{$SVCSTATUS,$NTPSTATUS,$DISKSTATUS,$CPUSTATUS,$BATTSTATUS}" | sed s/"'"/'"'/g
